<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      Manifest for web apps and bookmarks
    </title>
    <script src="http://www.w3.org/Tools/respec/respec-w3c-common" class=
    "remove">
</script>
    <script class='remove'>
/**/
    var respecConfig = {
    specStatus: 'ED',
    shortName: 'appmanifest',
    subtitle: 'Living Document',
    edDraftURI: 'http://w3c.github.io/manifest/',
    previousMaturity: 'FPWD',
    previousURI: 'http://www.w3.org/TR/2013/WD-appmanifest-20131217/',
    editors: [{
        name: 'Marcos Caceres',
        company: 'Mozilla Corporation',
        companyURL: 'http://mozilla.com'
    }, {
        name: 'Anssi Kostiainen',
        company: 'Intel Corporation',
        companyURL: 'http://intel.com'
    }, {
        name: 'Kenneth Rohde Christiansen',
        company: 'Intel Corporation',
        companyURL: 'http://intel.com'
    }],
    wg: 'Web Applications (WebApps) Working Group',
    wgURI: 'http://www.w3.org/2008/webapps/',
    wgPublicList: 'public-webapps',
    wgPatentURI: 'http://www.w3.org/2004/01/pp-impl/42538/status',
    otherLinks: [
        {
        key: 'Repository',
        data: [{
            value: 'We are on Github.',
            href: 'https://github.com/sysapps/manifest'
        }, {
            value: 'File a bug.',
            href: 'https://github.com/sysapps/manifest/issues'
        }, {
            value: 'Commit history.',
            href: 'https://github.com/sysapps/manifest/commits/gh-pages'
        }]
    }],
    localBiblio: {
        'FETCH': {
            'authors': [
                'Anne van Kesteren'
            ],
            'href': 'http://fetch.spec.whatwg.org/',
            'title': 'Fetch',
            'status': 'Living Standard',
            'publisher': 'WHATWG'
        }
    }
    };
    </script>
  </head>
  <body>
    <section id='abstract'>
      <p>
        This specification defines a JSON-based document, which provides
        developers with a centralized place to declare startup parameters and
        application defaults. This includes, but is not limited to, declaring
        the default orientation for a web application as well as how the
        application is to be displayed when launched (i.e., fullscreen, in the
        browser, with a minimal user interface, or standalone).
      </p>
      <p>
        Using this data, user agents can provide web applications with a user
        experience that is more comparable to that of a native application.
      </p>
      <p>
        This specification also defines an API for bookmarking web applications
        and a means for checking the display mode in which the web application
        is running.
      </p>
      <p>
        In addition, this specification defines the <code>manifest</code> link
        type, which provides a declarative means for a document to be
        associated with a manifest.
      </p>
    </section>
    <section id="sotd">
      <p>
        Implementors should be aware that this specification is not stable.
        <strong>Implementors who are not taking part in the discussions are
        likely to find the specification changing out from under them in
        incompatible ways.</strong> Vendors interested in implementing this
        specification before it eventually reaches the Candidate Recommendation
        phase should join the aforementioned mailing lists and take part in the
        discussions.
      </p>
    </section>
    <section class="informative">
      <h2>
        Usage Examples
      </h2>
      <p>
        This section shows how developers can make use of the various features
        of this specification.
      </p>
      <section class="informative">
        <h3>
          Example manifest
        </h3>
        <p>
          The following shows a typical <a>manifest</a>.
        </p>
        <pre class="example highlight json" title="typical manifest">
{
  "starturl": "/start.html",
  "display": ["fullscreen"],
  "default-orientation": ["landscape"]
}
</pre>
      </section>
      <section class="informative">
        <h3>
          Using a <code>link</code> element to link to a manifest
        </h3>
        <p>
          Example of using a <code>link</code> element to associate a website
          with a <a>manifest</a>.
        </p>
        <pre class="example highlight html" title="linking to a manifest">
&lt;link rel="manifest" href="add_to_homescreen.json"&gt;
</pre>
      </section>
      <section class="informative">
        <h3>
          Using the API
        </h3>
        <p>
          This example shows how to check if the <a>display mode</a> of the web
          application is "<a>standalone</a>".
        </p>
        <pre class="example highlight html" title="detecting standalone mode">
&lt;script&gt;
if ("displayMode" in navigator &amp;&amp; navigator.displayMode === "standalone") {
   //Do standalone specific stuff...
   document.documentElement.classList.add("standalone");
}
&lt;/script&gt;
</pre>
      </section>
      <section class="informative">
        <h3>
          Requesting the document be bookmarked
        </h3>
        <p>
          The following example shows how a developer can ask a user to
          bookmark a web application through an activation gesture, such as the
          click of a button. Similarly to <code>window.open()</code>, the
          <code><span class=
          "example highlight html">requestBookmark</span>()</code> method only
          works through explicit user action; calling it without any user
          interaction will simply cause the resulting promise to be rejected
          with an error.
        </p>
        <pre class="example highlight html" title=
        "requesting to bookmark a web app">
&lt;script&gt;
var installButton = document.querySelector("#install");

//Bookmarking only works if initiated by user interaction
installButton.addEventListener("click", function(e){
   navigator.requestBookmark().then(thankUser, stopBuggingUser);
});
&lt;/script&gt;

&lt;button id="install"&gt;
  Bookmark &lt;b&gt;Awesome App!&lt;/b&gt;
&lt;/button&gt;
</pre>
      </section>
    </section>
    <section>
      <h2>
        Use cases and requirements
      </h2>
      <p>
        This document attempts to address the <cite><a href=
        "http://w3c-webmob.github.io/installable-webapps/">Use Cases and
        Requirements for Installable Web Apps</a></cite>.
      </p>
    </section>
    <section>
      <h2>
        Common conventions and dependencies
      </h2>
      <p id="ecmascript-abstractop">
        Algorithms in this specification use the conventions set forth in
        [[!ECMASCRIPT]] and [[HTML]] - such as the use of steps and sub-steps,
        and so forth.
      </p>
      <p>
        The <dfn><a href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-ordinary-object-internal-methods-and-internal-slots-getownproperty-p">
        [[\GetOwnProperty]]</a></dfn> operations, <dfn>promise</dfn> objects,
        and the <a class="external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-ecmascript-data-types-and-values">
        <dfn>Type</dfn>(<var>x</var>)</a> notation are defined in
        [[!ECMASCRIPT]]. Processing also relies on various algorithms defined
        in [[!HTML]], [[!FETCH]], and [[!URL]].
      </p>
      <p>
        When instructed to <dfn>Trim</dfn>(<var>x</var>), a user agent MUST
        behave as if [[!ECMASCRIPT]]'s <a href=
        "https://people.mozilla.org/~jorendorff/es6-draft.html#sec-string.prototype.trim">
        String.prototype.trim()</a> function had been called on the string
        <var>x</var>.
      </p>
      <p>
        As the manifest uses the JSON format, this specification relies on the
        types defined in [[!ECMA-404]] specification: namely <dfn title=
        "json-object">object</dfn>, <dfn title="json-array">array</dfn>,
        <dfn title="json-number">number</dfn>, <dfn title=
        "json-string">string</dfn>, <code>true</code>, <code>false</code>, and
        <code>null</code>. Strict type checking is not enforced by this
        specification. Instead, each member's definition specifies the steps
        required to process a particular member and what to do when a type does
        not match what is expected.
      </p>
      <p>
        When an algorithm asks the user agent to <dfn>issue a developer
        warning</dfn>, the user agent MAY report the conformance violation to
        the developer in a user-agent-specific manner (e.g., report the problem
        in an error console), or MAY ignore the error and do nothing.
      </p>
      <p>
        When instructed to <dfn>ignore</dfn> something while processing a
        member or value, the user agent MUST act as if whatever member or value
        caused the condition is absent in the manifest document.
      </p>
    </section>
    <section>
      <h2>
        Display modes
      </h2>
      <p>
        A <dfn>display mode</dfn> is the manner in which a developer would like
        the Web application to be shown to a user when it is launched from a
        bookmark (e.g., in fullscreen). Display modes are intended to
        correspond to the user interface metaphors and functionality in use on
        a given platform.
      </p>
      <p>
        This specification defines a number of display modes that a user agent
        is expected to match to comparable platform-specific situations. The
        display modes, as well as what kind of experience they are intended to
        provide when a web application is opened from a bookmark, are as
        follows:
      </p>
      <dl>
        <dt>
          <code><dfn id="dm-browser">browser</dfn></code>
        </dt>
        <dd>
          Open the web application using whatever is the normal convention for
          opening hyperlinks in the user agent (e.g., in a browser tab or a new
          window). The <code>browser</code> display mode is the <dfn>fallback
          display mode</dfn> for when the developer does not declare one in the
          manifest, or for when none of the developer's desired <a>display
          modes</a> are supported by the user agent.
        </dd>
        <dt>
          <code><dfn id="dm-standalone">standalone</dfn></code>
        </dt>
        <dd>
          Opens the web application without UI elements for controlling
          navigation, but can include other UI elements such as a status bar.
          On desktop platforms, for example, this would open the bookmark in a
          standalone window outside the browser.
        </dd>
        <dt>
          <code><dfn id="dm-fullscreen">fullscreen</dfn></code>
        </dt>
        <dd>
          Opens the web application fullscreen: that is occupying the entirety
          of the display, including the parts normally excluded from
          the&nbsp;screen area and without any user agent&nbsp;chrome.
        </dd>
        <dt>
          <code><dfn id="dp-minimal-ui">minimal-ui</dfn></code>
        </dt>
        <dd>
          Same as standalone, but provides the end-user with some means to
          access a minimal set of UI elements for controlling navigation (i.e.,
          back, forward, reload, and perhaps some way of viewing the document's
          address). A user agent MAY include other platform specific UI
          elements, such as "share" and "print" buttons or whatever is
          customary on the platform and/or user agent.
        </dd>
      </dl>
      <p>
        Once a user agent applies a particular display mode to a web
        application, it becomes that applications <dfn>default display
        mode</dfn> for the lifetime of the application (i.e., it is used as the
        display mode for all top-level documents to which the window is
        navigated). Other specifications, as well as the end user, MAY override
        the <a>default display mode</a>.
      </p>
    </section>
    <section>
      <h2>
        Manifest
      </h2>
      <p>
        A <dfn>manifest</dfn> is a JSON document that contains startup
        parameters and application defaults for when a web application is
        launched from a bookmark. A manifest consists of a top-level <a href=
        "#json-object">object</a> that contains zero or more members. Each of
        the members are defined below, as well as how their values are
        processed.
      </p>
      <section>
        <h3>
          Obtaining a manifest
        </h3>
        <p>
          A user agent can obtain a manifest either from a top-level document
          or by fetching it directly from some URL (independently of a
          top-level document).
        </p>
        <p>
          A user agent is said to have <dfn>obtained a manifest from a
          top-level document</dfn> when a user navigates to a web application
          and she or he explicitly makes a request to bookmark the top-level
          document. For example, the user uses the browser's user interface to
          either bookmark or add the web app to the home screen. The manifest
          is associated with a document through either the
          <code>manifest</code> link relationship or through the
          <a><a>well-known manifest</a> - this includes via a successful
          request to bookmark a web application through the
          <code>requestBookmark()</code> method.</a>
        </p>
        <p>
          Conversely, a user agent is said to have <dfn>obtained a manifest
          directly</dfn> when the user agent fetches the manifest independently
          of any top-level document. For example, a user agent fetches a
          manifest from a URL without first navigating to any
          <code>document</code> or the user agent makes use of the well-know
          manifest without first navigating to the web application.
        </p>
        <p>
          It is OPTIONAL for a user agent to support the ability to <a>obtain a
          manifests directly</a>.
        </p>
      </section>
      <section>
        <h3>
          Fetching a manifest
        </h3>
        <p>
          The <dfn>steps for fetching a manifest</dfn> are given by the
          following algorithm. It takes a URL <var>url</var> as an argument.
          This algorithm will return either a response or an error.
        </p>
        <ol>
          <li>Let <var>response</var> be the result of <a href=
          "http://fetch.spec.whatwg.org/#concept-fetch">fetching</a> the
          manifest from <var>url</var>.
          </li>
          <li>Return <var>response</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          Processing the manifest
        </h3>
        <p>
          The <dfn>steps for processing a manifest</dfn> are given by the
          following algorithm. The algorithm takes a <var>text</var> string as
          an argument, which represents a <a>manifest</a>.
        </p>
        <ol>
          <li>Let <var>manifest</var> be the result of invoking the <a href=
          "https://people.mozilla.org/~jorendorff/es6-draft.html#sec-json.parse">
            parse</a> function of the JSON object defined in [[!ECMASCRIPT]]
            with <var>text</var> as its only argument. If parsing throws an
            error:
            <ol>
              <li>Issue a developer warning.
              </li>
              <li>Set <var>manifest</var> to be the result of invoking
                <a href="https://people.mozilla.com/~jorendorff/es6-draft.html#sec-15.12.2">
                parse</a> with <code>"{}"</code> as the argument.
              </li>
            </ol>
          </li>
          <li>Let <var>start url</var> be the result of running the <a>steps
          for processing the <code>starturl</code> member</a>.
          </li>
          <li>Let <var>display modes</var> be the result of running <a>steps
          for processing the <code>display</code> member</a> with
          <var>manifest</var> as the argument.
          </li>
          <li>Let <var>default display mode</var> be the first item of
          <var>display modes</var>.
          </li>
          <li>Let <var>orientations</var> be the result of running the <a>steps
          for processing the <code>default-orientation</code></a> member with
          <var>manifest</var> and <var>default display mode</var> as arguments.
          </li>
          <li>From <var>orientations</var>, select a suitable orientation for
          the application and let that serve as the default orientation for the
          life of the web application.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code>display</code> member
        </h3>
        <p>
          The <code>display</code> member is an <a href="#json-array">array</a>
          of <a href="#json-string">strings</a>, whose items represent the
          preferred <a>display modes</a> for the web application. Order in the
          <a href="#json-array">array</a> is significant, with the first item
          being the developer's most preferred, followed by the next most
          preferred and so forth. When the member is missing or
          <span data-dobid="hdw">erroneous</span>, the user agent uses the
          fallback display mode.
        </p>
        <p>
          The <dfn>steps for processing the <code>display</code> member</dfn>
          are given by the following algorithm. The algorithm takes a manifest
          <var>manifest</var> as an argument, and returns an set.
        </p>
        <ol>
          <li>Let <var>result</var> be an ordered set.
          </li>
          <li>Let <var>display values</var> be the result of calling the
          [[\GetOwnProperty]] internal method of <var>manifest</var> passing
          "<code>display</code>" as the argument.
          </li>
          <li>If <var>display values</var> is not an instance of <a href=
          "https://people.mozilla.org/~jorendorff/es6-draft.html#sec-array-exotic-objects">
            Array</a>:
            <ol>
              <li>If <a>Type</a>(<var>display value</var>) is not "undefined",
              issue a developer warning that the type is not supported.
              </li>
            </ol>
          </li>
          <li>Otherwise, for each <var>item</var> in <var>display values</var>
          in order from first to last:
            <ol>
              <li>If <a>Type</a>(<var>item</var>) is not "string", ignore this
              <var>item</var> and move onto the next item in <var>display
              values</var> (if any are left).
              </li>
              <li>
                <a>Trim</a>(<var>item</var>) and set <var>item</var> to be the
                resulting string.
              </li>
              <li>If <var>item</var> is not a display mode that the user agent
              supports, or <var>result</var> already contains <var>item</var>,
              ignore this <var>item</var> and proceed to the next.
              </li>
              <li>Otherwise, append <var>item</var> to <var>result</var>.
              </li>
            </ol>
          </li>
          <li>If result contains no items, add the <a>fallback display mode</a>
          to <var>result</var>.
          </li>
          <li>Return <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code>default-orientation</code> member
        </h3>
        <p>
          The <dfn>default-orientation</dfn> member is an <a href=
          "#json-array">array</a> of <a href="#json-string">strings</a> that
          serve as hints for the user agent as to the preferred screen
          orientations in which to display the web application. The possible
          values are any of the <a href=
          "https://dvcs.w3.org/hg/screen-orientation/raw-file/tip/Overview.html#allowed-orientations">
          allowed orientations</a> as defined in [[!screen-orientation]]. Order
          within the array is significant, with the first item being the
          developer's most preferred, followed by the next most preferred and
          so forth. When the <a><code>default-orientation</code></a> member is
          missing, unsupported, or the value is <span data-dobid=
          "hdw">erroneous</span>, the user agent provides a user agent specific
          default orientation for the web application.
        </p>
        <p>
          Although the specification relies on the <a href=
          "https://dvcs.w3.org/hg/screen-orientation/raw-file/tip/Overview.html#allowed-orientations">
          allowed orientations</a> from the [[!screen-orientation]]
          specification, it is OPTIONAL for a user agent to implement the
          [[!screen-orientation]] API. Supporting the
          [[!screen-orientation]]API is, of course, RECOMMENDED.
        </p>
        <p>
          If the user agent chooses to use one of the <a href=
          "https://dvcs.w3.org/hg/screen-orientation/raw-file/tip/Overview.html#allowed-orientations">
          allowed orientations</a> in the <code>orientations</code> member,
          then that becomes the default orientation for the web application for
          as long as the application is running (unless overridden by some
          other means at runtime). This means that the user agent MUST return
          the orientation to the default orientation any time the orientation
          is unlocked [[!screen-orientation]] or the top-level browsing context
          is <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#navigate">naviagated</a>.
        </p>
        <p>
          Note: the <code>orientations</code> member's items are expected to
          only apply when the web application is launched. Once the web
          application is running, it is expected that other means could be used
          to change the orientation of the application (such as via
          [[!screen-orientation]] API).
        </p>
        <p>
          The <dfn>steps for processing the <code>orientations</code>
          member</dfn> are given by the following algorithm. The algorithm
          takes a <a>manifest</a> <var>manifest</var> and display mode
          <var>mode</var> as an argument, and returns an set.
        </p>
        <ol>
          <li>Let <var>result</var> be a new set.
          </li>
          <li>Let <var>orientations</var> be the result of calling the
          [[\GetOwnProperty]] internal method of <var>manifest</var> passing
          "<code>default-orientations</code>" as the argument.
          </li>
          <li>If <var>orientations</var> is not an instance of <a href=
          "https://people.mozilla.org/~jorendorff/es6-draft.html#sec-array-exotic-objects">
            Array</a>:
            <ol>
              <li>If <a>Type</a>(<var>orientations</var>) is not "undefined",
              issue a developer warning.
              </li>
            </ol>
          </li>
          <li>Otherwise, for each <var>item</var> in <var>orientations</var> in
          order from first to last:
            <ol>
              <li>If type(<var>item</var>) is not "string", ignore this
              <var>item</var>, <a>issue a developer warning</a>, and move onto
              the next item in <var>orientations</var> (if any).
              </li>
              <li>Trim(<var>item</var>) and set <var>item</var> to be the
              resulting string.
              </li>
              <li>If <var>item</var> is not an orientation that the user agent
              supports, or <var>result</var> already contains <var>item</var>,
              or the item cannot be used together with <var>mode</var> ignore
              this <var>item</var> and proceed to the next.
              </li>
              <li>Otherwise, append <var>item</var> to <var>result</var>.
              </li>
            </ol>
          </li>
          <li>Return <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code>starturl</code> member
        </h3>
        <p>
          The <dfn title="member-url">starturl</dfn> member is a <a title=
          "json-string">string</a> that represents the <a href=
          "http://url.spec.whatwg.org/#concept-url">URL</a> that the developer
          would prefer the user agent <a href=
          "http://www.w3.org/html/wg/drafts/html/master/single-page.html#browsers">
          load</a> when the user activates a bookmark (e.g., when the user
          clicks on the icon of the web application from a device's application
          menu or homescreen). When the developer omits the
          <code>starturl</code> member from the <a>manifest</a>, the user agent
          will instead use the <a href=
          "http://url.spec.whatwg.org/#concept-url">URL</a> of the
          <code>document</code> from which the web application was bookmarked.
        </p>
        <p>
          The <a title="member-url"><code>starturl</code></a> member is purely
          advisory, and a user agent MAY <a>ignore</a> it or provide the
          end-user the choice not to make use of it. In the case where the user
          agent ignores the <a title="member-url"><code>starturl</code></a>
          member, it MAY fall back to using the URL of the document from which
          the page is being bookmarked.
        </p>
        <p>
          A user agent MAY also allow the end-user to modify the URL when the
          bookmark is being added or any time thereafter.
        </p>
        <p>
          The <dfn>steps for processing the <code>starturl</code> member</dfn>
          are given by the following algorithm. The algorithm takes a
          <a>manifest</a> <var>manifest</var> and a <a href=
          "http://url.spec.whatwg.org/#concept-url">URL</a> <var>document
          URL</var>. This algorithm will return a <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#valid-url">valid
          URL</a>.
        </p>
        <ol>
          <li>Let <var>value</var> be the result of calling the
          [[\GetOwnProperty]] internal method of the <var>manifest</var> with
          argument "<code>url</code>".
          </li>
          <li>Let <var>type</var> be <a>Type</a>(<var>value</var>).
          </li>
          <li>If <var>type</var> is not "string", then:
            <ol>
              <li>If <var>type</var> is not "<code>undefined</code>",
              optionally issue a developer warning that the type is not
              supported.
              </li>
              <li>Return <var>document URL</var>.
              </li>
            </ol>
          </li>
          <li>Otherwise, <a href=
          "http://url.spec.whatwg.org/#parsing">parse</a> <var>value</var>
          using <var>document URL</var> as the base URL and return the result.
          </li>
        </ol>
      </section>
      <section id="linking">
        <h3>
          Linking to a manifest
        </h3>
        <p>
          The <code>manifest</code> keyword can be used with a [[!HTML]]
          <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#the-link-element">
          link</a> element. This keyword creates an <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#external-resource-link"
          title="external resource link">external resource link</a>.
        </p>
        <table border="1">
          <tr>
            <th rowspan="2">
              Link type
            </th>
            <th colspan="2">
              Effect on...
            </th>
            <th rowspan="2">
              Brief description
            </th>
          </tr>
          <tr>
            <th>
              <code><a href="#the-link-element">link</a></code>
            </th>
            <th>
              <code><a href="#the-a-element">a</a></code> and <code><a href=
              "#the-area-element">area</a></code>
            </th>
          </tr>
          <tr>
            <td>
              <code title="rel-manifest">manifest</code>
            </td><!-- second most used <link rel> value -->
            <td>
              <a href=
              "http://www.whatwg.org/specs/web-apps/current-work/#external-resource-link"
              title="external resource link">External Resource</a>
            </td>
            <td>
              not allowed
            </td>
            <td>
              Imports or links to a manifest.
            </td>
          </tr>
        </table>
        <p>
          The default media type for resources associated with the
          <code>manifest</code> <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#linkTypes">link
          type</a> is <code>application/manifest+json</code>.
        </p>
        <p>
          In cases where more than one <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#the-link-element">
          <code>link</code></a> element with a <code>manifest</code> link type
          appears in a <code>document</code>, the user agent MUST use the first
          inserted link element and ignore all subsequent <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#the-link-element">
          <code>link</code></a> elements with a <code>manifest</code> link type
          (even if the first element was <span data-dobid=
          "hdw">erroneous</span>).
        </p>
        <p>
          The appropriate time to <a href=
          "http://fetch.spec.whatwg.org/#concept-fetch">fetch</a> the manifest
          is when the <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#external-resource-link"
          title="external resource link">external resource link</a> is created
          or when its element is <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#insert-an-element-into-a-document"
          title="insert an element into a document">inserted into a
          document</a>, whichever happens last. However, a user agent MAY opt
          to delay fetching a manifest until after the document and its other
          resources have loaded (i.e., to not delay the availability of content
          and scripts required by the <code>document</code>).
        </p>
        <p>
          Certain error conditions can result in a manifest being treated as an
          <a>invalid manifest</a>. An <dfn>invalid manifest</dfn> is one that
          is deemed to be non-conforming in such a way that it would not be
          possible for the user agent to continue processing (e.g., it can't be
          parsed by the JSON parser because of syntax errors, it couldn't be
          fetched from the network). In such a case, it is RECOMMENDED that the
          user agent <a>issue a developer warning</a>. In either case, when a
          step results in an <a>invalid manifest</a> the user agent MUST abort
          whatever step or sub-step caused the condition.
        </p>
        <p>
          To obtain a manifest, a user agent MUST:
        </p>
        <ol>
          <li>If the <code>link</code> element lacks a <code>href</code>
          attribute, abort this algorithm.
          </li>
          <li>Run the <a>steps for fetching a manifest</a>, with the value of
          <code>href</code> attribute as the url, and let <var>response</var>
          be the response.
          </li>
          <li>If response's type is "error", treat this as an <span>invalid
          manifest</span>.
          </li>
          <li>Otherwise, let <var>manifest</var> be the result of running the
          <a>steps for processing a manifest</a>.
          </li>
          <li>Otherwise, in a user agent specific manner, and when the end-user
          so desires, provide a means for the end-user to view the relevant
          contents of the <var>manifest</var>; and provide a means for the
          end-user to create a bookmark based on that information.
          </li>
        </ol>
      </section>
      <section id="proprietary-extensions" class="informative">
        <h3>
          Proprietary extensions to the manifest
        </h3>
        <p>
          Although proprietary extensions are undesirable, they can't
          realistically be avoided. As such, the RECOMMENDED way to add
          proprietary extension is to use a vendor prefix.
        </p>
        <p>
          This following is an example of two hypothetical vendor extensions.
        </p>
        <pre class="example highlight json" title="vendor extensions">
{
  ...
  "webkit-fancyfeature": "some/url/img",
  "moz-awesome-thing": { ... }
  ...
}
        
</pre>
      </section>
    </section>
    <section>
      <h2>
        Launching a standalone web application
      </h2>
      <p>
        When an application is launched:
      </p>
      <ol>
        <li>If the web application has a required orientation, run the
        <span>steps for selecting the orientation</span>.
        </li>
      </ol>
    </section>
    <section>
      <h2>
        Extensions to the <code>Navigator</code> object
      </h2>
      <dl class="idl" title="partial interface Navigator">
        <dt>
          readonly attribute DOMString? displayMode
        </dt>
        <dd>
          The <code>displayMode</code> attribute provides a means for a
          developer to check which display mode the application is in. When
          getting, the user agent MUST return a DOMString that represents the
          display mode of the Web application. If the <a>display mode</a> is
          unknow, return <code>null</code>.
        </dd>
        <dt>
          Promise requestBookmark()
        </dt>
        <dd>
          When invoked, the user agent MUST run the <a>steps to request to add
          bookmark</a>.
        </dd>
      </dl>
      <p>
        The <dfn>steps to request to add a bookmark</dfn> are given by the
        following algorithm. The algorithm returns a promise.
      </p>
      <ol>
        <li>Let <var>promise</var> be a newly-created <a>promise</a>.
        </li>
        <li>If this method was not invoked as a result of explicit user action,
        then:
          <ol>
            <li>Reject <var>promise</var> with new <code><a href=
            "http://dom.spec.whatwg.org/#exception-domexception">DOMException</a></code>
            whose name is "<code><a href=
            "http://dom.spec.whatwg.org/#securityerror">SecurityError</a></code>"
            and return.
            </li>
          </ol>
        </li>
        <li>If the document's <a>mode of operation</a> is <a>standalone</a>:
          <ol>
            <li>Reject <var>promise</var> with a new <code><a href=
            "http://dom.spec.whatwg.org/#exception-domexception">DOMException</a></code>
            whose name is "<code><a href=
            "http://dom.spec.whatwg.org/#notsupportederror">NotSupported</a></code>"
            and return.
            </li>
          </ol>
        </li>
        <li>Let <var>info</var> be the result of getting a web application's
        metadata.
        </li>
        <li>Using <var>info</var>, and in a manner that is user-agent specific,
        allow the end user to make a choice as to whether they want to add the
        bookmark:
          <ol>
            <li>If the end-user aborts the request to add the bookmark (e.g.,
            they hit escape, or press a "cancel" button), then Reject
            <var>promise</var> with a new <code><a href=
            "http://dom.spec.whatwg.org/#exception-domexception">DOMException</a></code>
            whose name is "<code><a href=
            "http://dom.spec.whatwg.org/#aborterror">AbortError</a></code>" and
            return.
            </li>
            <li>Otherwise, resolve <var>promise</var> with
            <code>undefined</code>.
            </li>
          </ol>
        </li>
        <li>Return <var>promise</var>.
        </li>
      </ol>
    </section>
    <section>
      <h2>
        IANA considerations
      </h2>
      <p>
        The following registration is for community review and will be
        submitted to the IESG for review, approval, and registration with IANA.
      </p>
      <section>
        <h3>
          The "manifest.json" well-known URI
        </h3>
        <p>
          The <dfn>well-known manifest</dfn> is a manifest that a user agent
          fetches in the following manner.
        </p>
        <p>
          If a user agent attempts to <a>obtain a manifest from a top-level
          document</a>, but no manifest link relationship is declared, the user
          agent MUST attempt to <a href=
          "http://fetch.spec.whatwg.org/#concept-fetch">fetch</a> a manifest
          from the <a href=
          "http://url.spec.whatwg.org/#concept-absolute-url">absolute URL</a>
          obtained by resolving the URL
          "<code>/.well-known/manifest.json</code>" against <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#the-document's-address">
          the document's address</a>. The user agent can then use the resulting
          manifest as if the page had declared that <a>manifest</a> using the
          <code>manifest</code> keyword.
        </p>
        <p>
          In the case where the user agent obtains the manifest directly, the
          user agent MAY attempt to <a href=
          "http://fetch.spec.whatwg.org/#concept-fetch">fetch</a> a manifest
          with the <a href=
          "http://url.spec.whatwg.org/#concept-absolute-url">absolute URL</a>
          obtained by resolving the URL
          "<code>/.well-known/manifest.json</code>" against an applicaiton
          specific base URL (e.g., the URL
          "<code>app://abc123/.well-known/manifest.json</code>").
        </p>
        <p>
          This specification registers the "manifest.json" well-known URI in
          the <a href=
          "http://www.iana.org/assignments/well-known-uris/well-known-uris.xml">
          Well-Known URI Registry</a> as required by [[!RFC5785]].
        </p>
        <dl>
          <dt>
            URI suffix:
          </dt>
          <dd>
            manifest.json
          </dd>
          <dt>
            Change controller:
          </dt>
          <dd>
            <a href="www.w3.org/2008/webapps/">Web Applications (WebApps)
            Working Group</a>
          </dd>
          <dt>
            Specification document(s):
          </dt>
          <dd>
            This document is the relevant specification.
          </dd>
        </dl>
      </section>
      <section>
        <h3>
          Media type registration
        </h3>
        <p>
          This section contains the required text for MIME media type
          registration with IANA.
        </p>
        <p>
          The <dfn>media type for a manifest</dfn> is
          <code>application/manifest+json</code>.
        </p>
        <p>
          If the protocol over which the manifest is transferred supports the
          [[!MIME-TYPES]] specification (e.g. HTTP), it is RECOMMENDED that the
          manifest be labeled with the <a>media type for a manifest</a>.
        </p>
        <dl>
          <dt>
            Type name:
          </dt>
          <dd>
            application
          </dd>
          <dt>
            Subtype name:
          </dt>
          <dd>
            manifest+json
          </dd>
          <dt>
            Required parameters:
          </dt>
          <dd>
            N/A
          </dd>
          <dt>
            Optional parameters:
          </dt>
          <dd>
            N/A
          </dd>
          <dt>
            Encoding considerations:
          </dt>
          <dd>
            Same as for application/json
          </dd>
          <dt>
            Security considerations:
          </dt>
          <dd>
            <p>
              As the manifest format is JSON and will commonly be encoded using
              [[!UNICODE]], the security considerations described in
              [[!ECMA-404]] and [[!UNICODE-SECURITY]] apply. In addition,
              implementors need to impose their own implementation-specific
              limits on the values of otherwise unconstrained member types,
              e.g. to prevent denial of service attacks, to guard against
              running out of memory, or to work around platform-specific
              limitations.
            </p>
            <p>
              Web applications will generally contain ECMAScript, HTML, CSS
              files, and other media, which are executed in a sand-boxed
              environment. As such, implementors need to be aware of the
              security implications for the types they support. Specifically,
              implementors need to consider the security implications outlined
              in the [[!CSS-MIME]] specification, the [[!ECMAScript-MIME]]
              specification, and the [[!HTML]] specification.
            </p>
            <p>
              As web applications can contain content that is able to
              simultaneously interact with the local device and a remote host,
              implementors need to consider the privacy implications resulting
              from exposing private information to a remote host. Mitigation
              and in-depth defensive measures are an implementation
              responsibility and not prescribed by this specification. However,
              in designing these measures, implementors are advised to enable
              user awareness of information sharing, and to provide easy access
              to interfaces that enable revocation of permissions.
            </p>
            <p>
              As this specification allows for the declaration of URLs within
              certain members of a manifest, implementors need to consider the
              security considerations discussed in the [[!URL]] specification.
              Implementations intending to display <abbr title=
              "Internationalized Resource Identifiers">IRIs</abbr> and
              <abbr title="Internationalized domain name">IDNA</abbr> addresses
              found in the manifest are strongly encouraged to follow the
              security advice given in [[!UNICODE-SECURITY]].
            </p>
          </dd>
          <dt>
            Applications that use this media type:
          </dt>
          <dd>
            Web browsers
          </dd>
          <dt>
            Additional information:
          </dt>
          <dd>
            <dl>
              <dt>
                Magic number(s):
              </dt>
              <dd>
                N/A
              </dd>
              <dt>
                File extension(s):
              </dt>
              <dd>
                .json, .manifest
              </dd>
              <dt>
                Macintosh file type code(s):
              </dt>
              <dd>
                TEXT
              </dd>
            </dl>
          </dd>
          <dt>
            Person &amp; email address to contact for further information:
          </dt>
          <dd>
            The <a href="http://www.w3.org/2008/webapps/" rel="nofollow">Web
            Applications (WebApps) Working Group</a> can be contacted at
            <a href="http://lists.w3.org/Archives/Public/public-webapps/" rel=
            "nofollow">public-webapps@w3.org</a>.
          </dd>
          <dt>
            Intended usage:
          </dt>
          <dd>
            COMMON
          </dd>
          <dt>
            Restrictions on usage:
          </dt>
          <dd>
            none
          </dd>
          <dt>
            Author:
          </dt>
          <dd>
            W3C's Web Applications (WebApps) Working Group.
          </dd>
          <dt>
            Change controller:
          </dt>
          <dd>
            W3C.
          </dd>
        </dl>
      </section>
    </section>
    <section id="conformance" data-status="done">
      <p>
        There is only one class of product that can claim conformance to this
        specification: a <dfn>user agent</dfn>.
      </p>
    </section>
    <section class="appendix">
      <h2>
        Acknowledgments
      </h2>
      <p>
        This document reuses text from the WHATWG [[!HTML]] specification as
        permitted by the license of that specification. The [[!HTML]]
        specification is edited by Ian Hickson.
      </p>
    </section>
  </body>
</html>
